
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Modules Â· cornerstone-tools</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-versions/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-theme-cornerstone/cornerstone.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="./" />
    
    
    <link rel="prev" href="../custom-tools/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                



<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://github.com/cornerstonejs/cornerstoneTools/releases">
            
                    
                    Release Notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <a target="_blank" href="https://tools.cornerstonejs.org/examples">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Essentials</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../installation.html">
            
                <a href="../installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../">
            
                <a href="../#what-is-cornerstone-tools-js">
            
                    
                    What is CornerstoneTools.js?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../">
            
                <a href="../#getting-started">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../">
            
                <a href="../#configuration">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../">
            
                <a href="../#adding-and-using-tools">
            
                    
                    Adding and Using Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="../">
            
                <a href="../#next-steps">
            
                    
                    Next Steps
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../debugging/">
            
                <a href="../debugging/">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../contributing.html">
            
                <a href="../contributing.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Tools In-Depth</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/">
            
                    
                    Anatomy of a Tool
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/#modes">
            
                    
                    Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/#configuration">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/#interaction-types">
            
                    
                    Interaction Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/#strategies">
            
                    
                    Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/#mixins">
            
                    
                    Mixins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="../anatomy-of-a-tool/">
            
                <a href="../anatomy-of-a-tool/#measurement-data">
            
                    
                    Measurement Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../tool-types/">
            
                <a href="../tool-types/">
            
                    
                    Tool Types
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../tool-types/">
            
                <a href="../tool-types/#base-tool">
            
                    
                    Base Tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../tool-types/">
            
                <a href="../tool-types/#base-annotation-tool">
            
                    
                    Base Annotation Tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="../tool-types/">
            
                <a href="../tool-types/#base-brush-tool">
            
                    
                    Base Brush Tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="../tool-types/">
            
                <a href="../tool-types/#segmentation-tool">
            
                    
                    Segmentation Tool
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../tool-mixins/">
            
                <a href="../tool-mixins/">
            
                    
                    Tool Mixins
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../tool-mixins/">
            
                <a href="../tool-mixins/#binary-tools">
            
                    
                    Binary Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../tool-mixins/">
            
                <a href="../tool-mixins/#segmentation-mixins">
            
                    
                    Segmentation Mixins
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../custom-tools/">
            
                <a href="../custom-tools/">
            
                    
                    Custom Tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../custom-tools/">
            
                <a href="../custom-tools/#choosing-a-base-class">
            
                    
                    Choosing a Base Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="../custom-tools/">
            
                <a href="../custom-tools/#creating-your-tool">
            
                    
                    Creating your Tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="../custom-tools/">
            
                <a href="../custom-tools/#adding-mixins">
            
                    
                    Adding Mixins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.4" data-path="../custom-tools/">
            
                <a href="../custom-tools/#mode-change-callbacks">
            
                    
                    Mode Change Callbacks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.5" data-path="../custom-tools/">
            
                <a href="../custom-tools/#event-dispatcher-callbacks">
            
                    
                    Event Dispatcher Callbacks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="3.5" data-path="./">
            
                <a href="./">
            
                    
                    Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="./">
            
                <a href="./#global-configuration">
            
                    
                    GlobalConfiguration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.2" data-path="./">
            
                <a href="./#cursors">
            
                    
                    Cursor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5.3" data-path="./">
            
                <a href="./#segmentation">
            
                    
                    Segmentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../third-party-functionality/">
            
                <a href="../third-party-functionality/">
            
                    
                    Third-Party Functionality
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="../third-party-functionality/">
            
                <a href="../third-party-functionality/#item-types">
            
                    
                    Item Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2" data-path="../third-party-functionality/">
            
                <a href="../third-party-functionality/#registration">
            
                    
                    Registration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.3" data-path="../third-party-functionality/">
            
                <a href="../third-party-functionality/#imports">
            
                    
                    Imports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.4" data-path="../third-party-functionality/">
            
                <a href="../third-party-functionality/#tools">
            
                    
                    Tools
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Migrating</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../migration/">
            
                <a href="../migration/#2x">
            
                    
                    Migration from 2.x
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../migration/">
            
                <a href="../migration/#1x">
            
                    
                    Migration from 1.x
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Misc</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../debugging/">
            
                <a href="../debugging/">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" >
            
                <a target="_blank" href="https://tools.cornerstonejs.org/api/">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" >
            
                <span>
            
                    
                    3rd Party Tool Directory
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" >
            
                <span>
            
                    
                    Custom Tool Example Repositories
            
                </span>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>



                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
  
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Modules</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="modules">Modules</h1>
<p>A module is a namespaced storage object in the <code>store</code> that contains the following properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Requirement</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>configuration</td>
<td>Mandatory</td>
<td>An object that configures the module for app-wide usage. Configuration is intended to be manipulated by methods both internal and external to <code>cornerstoneTools</code>.</td>
</tr>
<tr>
<td>state</td>
<td>Optional</td>
<td>An object that stores the module&apos;s current state. State is intended to only be manipulated by <code>cornerstoneTools</code> and <code>cornerstoneTools</code> plugins. There is no rigorous structure state must follow, as it will be specific to what the module is trying to accomplish.</td>
</tr>
<tr>
<td>getters</td>
<td>Optional</td>
<td>An object comprised of functions that query state. Getters can be used for more complex queries of the state (e.g. to yield a value that references a specific <code>cornerstone</code> enabled element). Top level primitives that require no calculation should instead be accessed by <code>const property = state.property</code>, as this reduces boilerplate in implementation code.</td>
</tr>
<tr>
<td>setters</td>
<td>Optional</td>
<td>An object comprised of functions that modify state. Setters can be used for more complex input (e.g. <code>push</code> object <code>x</code> to array <code>y</code>). Top level primitives should be set by <code>state.property = value</code>, as this reduces boilerplate in implementation code.</td>
</tr>
<tr>
<td>onRegisterCallback (name)</td>
<td>Optional</td>
<td>This function is called when the module is registered to the <code>cornerstoneTools</code> <code>store</code>. It is used to perform any global initialization the module requires. The <code>name</code> the module was given upon registration is passed to the callback.</td>
</tr>
<tr>
<td>enabledElementCallback (enabledElement)</td>
<td>Optional</td>
<td>This function is called once for each <code>Enabled</code> element upon registering the module, and again any time a new <code>Enabled</code> element is added to the <code>cornerstoneTools</code> instance. The <code>Enabled</code> Element is passed to the callback.</td>
</tr>
<tr>
<td>removeEnabledElementCallback (enabledElement)</td>
<td>Optional</td>
<td>This function is called whenever an <code>Enabled</code> element is removed from the <code>cornerstoneTools</code> instance, allowing cleanup of unneeded data. The <code>Enabled</code> Element is passed to the callback.</td>
</tr>
</tbody>
</table>
<h2 id="global-configuration">Global Configuration </h2>
<p>TODO! Feel free to contribute.</p>
<h2 id="cursors">Cursors </h2>
<p>TODO! Feel free to contribute.</p>
<h2 id="segmentation">Segmentation </h2>
<p>The segmentation module deals with centralisation of 3D labelmap data for each stack of cornerstone images. The data is centralized for two reasons:</p>
<ul>
<li>Cornerstone data stored per imageId is of a 2D format, and labelmaps are very much 3D structures. Having the data for an entire 3D labelmap centralized, and 2D and 3D representations of it being accessible by cornerstone as needed provides the flexibility to perfom both 2D and 3D operations without having to re-aggregate data each time.</li>
<li>Storing the 3D labelmap in one <code>ArrayBuffer</code> allows for better interoperability and harmonous integration with 3D platforms, such as <a href="https://kitware.github.io/vtk-js/" target="_blank">vtk-js</a>. If using a WebGL library such as <code>vtk-js</code>, it is recommended you set the use of <code>Float32Array</code> segmentations in the segmentation module configuration.</li>
</ul>
<h3 id="data-structure">Data Structure</h3>
<p>The data is stored in a <em>top-down</em> hierarchal fashion, with the coarsest level being study-wide. The types themselves are JSDoc&apos;d in <code>src/store/modules/segmentationModule/index.js</code>, but a more in-depth overview is given here:</p>
<h4 id="series">Series</h4>
<p>The series object under <code>state.series</code> is the highest level object, containing a set of <code>BrushStackState</code>s with a 1:1 correlation with cornerstone stacks. Each <code>BrushStackState</code> is currently indexed each stack by the imageId of the first image in the stack.</p>
<h4 id="brushstackstate">BrushStackState</h4>
<p>A <code>BrushStackState</code> object contains two properties:</p>
<ul>
<li><code>labelmaps3D</code>: An array of one or more <code>Labelmap3D</code> objects, which are the same dimensions as the stack (<code>width * height * numberOfFrames</code>).</li>
<li>&apos;activeLabelmapIndex`: The array index of the active labelmap.</li>
</ul>
<p>Each <code>Labelmap3D</code> object can contain multiple non-overlapping segments. To use have overlapping segments in your application, use multiple <code>Labelmap3D</code>s.</p>
<h4 id="labelmap3d">Labelmap3D</h4>
<p>A <code>Labelmap3D</code> is a single, non-overlapping labelmap with the following properties:</p>
<ul>
<li><code>buffer</code>: An <code>ArrayBuffer</code> where the labels for each voxel are stored sequentially in increasing x, y, z. It has the same orientation as the stack, so increasing <code>z</code> is increasing <code>imageIdIndex</code> in the stack. By default, each label is stored as 2 bytes (encoded as Uint16Array), allowing for up to <code>65535</code> unique segments (+ 0 being empty/unlabelled). By setting the segmentation configuration property <code>arrayType</code> to <code>Float32Array</code> you can instead store the labelmap as a format more harmonious with <code>vtkjs</code>. <code>vtkjs</code> has to convert non-<code>Float32Array</code>s when generating textures to pass to the GPU, and this is very costly. If you are using vtkjs in your application its highly recommended to use <code>Float32Array</code>s for segmentations for decreased texture building times. This is especially noticable when using the <code>vtkjs</code> paint widget, for example.</li>
<li><code>labelmaps2D</code>: An array of <code>labelmap2D</code> views on the <code>buffer</code>, indexed by in-stack <code>imageIdIndex</code>. The <code>labelmaps2D</code> array is initially empty, and each view is defined only if data is added to it, and should be removed if set empty (all zero labels). This makes it easy for the segmentation renderer, I/O libraries such as <a href="https://github.com/dcmjs-org/dcmjs" target="_blank"><code>dcmjs</code></a>, and tools to localise the extent of segments without having to scan through every label in the stack.</li>
<li><code>metadata</code>: An array of metadata objects per segment. Metadata is optional and its form is application specific. You may want a simple name for your label in your UI, or you may want more complex objects referencing standard libraries for anatomical region. The metadata is not used internally by <code>cornerstoneTools</code>, but acts an optional logical place to keep such data for your application.</li>
<li><code>activeSegmentIndex</code>: The index of the segment to be created/modified when using <code>BaseBrushTool</code>s or segmentation tools, when th labelmap is active.</li>
<li><code>colorLUTIndex</code>: The index of the colorLUT to use when rendering the labelmap.</li>
<li><code>segmentsHidden</code>: An array of segments to hide from the canvas. Initially empty to save space, set an index to <code>true</code> to hide the corresponding segment.</li>
</ul>
<h4 id="labelmap2d">Labelmap2D</h4>
<p>A <code>Labelmap2D</code> is a 2D view of one frame of the segmentation, it is the object primarily interacted with from the cornerstone canvas, and has the following properties:</p>
<ul>
<li><code>pixelData</code>: a <code>Uint16Array</code> or <code>Float32Array</code> view of a portion of the parent <code>Labelmap3D</code>&apos;s <code>buffer</code>, corresponding to the frame. Array type depends on the segmentation module&apos;s <code>arrayType</code> setting.</li>
<li><code>segmentsOnLabelmap</code>: An array of segments present in the <code>pixelData</code>. Whenever a tool or external manipulates the <code>pixelData</code> viewed by the <code>Labelmap2D</code>, this list should be updated. This is generally very cheap to do on the fly, e.g. after a scissor action or after a full brush stroke, but speeds up IO dramatically when compressing data to DICOMSEG, for instance, as you can work out how much memory needs to be allocated with very simple checks.</li>
</ul>
<h3 id="usage-within-cornerstonetools">Usage within cornerstoneTools</h3>
<p>When using a tool on a cornerstone image, you can easily access the <code>Labelmap2D</code> of the active <code>Labelmap3D</code>. by querying the segmentationModule:</p>
<p>Import the <code>segmentationModule</code> <code>getters</code> at the top of the file.</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> { getModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./store&apos;</span>; <span class="hljs-comment">//appropriate relative path</span>

<span class="hljs-comment">// Destructure the parts of the module you require from the getters, setters, state and configuration. Here we only need the getters.</span>
<span class="hljs-keyword">const</span> { getters } = getModule(<span class="hljs-string">&apos;segmentation&apos;</span>);
</code></pre>
<p>Then during <code>cornerstoneTools</code> event callback, where <code>evt</code> is the event:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> eventData = evt.detail;
<span class="hljs-keyword">const</span> element = eventData.element;

<span class="hljs-keyword">const</span> {
  labelmap2D, <span class="hljs-comment">// The `Labelmap2D` for this imageId.</span>
  labelmap3D, <span class="hljs-comment">// The `Labelmap3D` for this stack.</span>
  currentImageIdIndex, <span class="hljs-comment">// The currentImageIdIndex of this image in the stack.</span>
  activeLabelmapIndex, <span class="hljs-comment">// The labelmapIndex of this active labelmap.</span>
} = getters.labelmap2D(element);
</code></pre>
<p>This provides you all the information you need. You can grab as few or as many elements of this object as you need by destructuring appropriately.</p>
<h4 id="editing-the-labelmap-directly">Editing the labelmap directly</h4>
<p>You can then edit the labelmap directly:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { pixelData } = labelmap2D;

pixelData[<span class="hljs-number">1337</span>] = <span class="hljs-number">9001</span>;
</code></pre>
<h4 id="using-the-drawbrushpixels-helper">Using the <code>drawBrushPixels</code> helper</h4>
<p>Or if using a brush you can use the <code>drawBrushPixels</code> helper to paint an array of 2D-coordinates to the <code>Labelmap2D</code>.</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { rows, columns } = eventData.image;
<span class="hljs-keyword">const</span> pointerArray = [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>]]; <span class="hljs-comment">// Something grabbed by your brush.</span>
<span class="hljs-keyword">const</span> shouldErase = <span class="hljs-literal">false</span>;

<span class="hljs-comment">// Imported from src/util/segmentation</span>
drawBrushPixels(
  pointerArray,
  labelmap2D.pixelData,
  labelmap3D.activeSegmentIndex,
  columns,
  shouldErase
);
</code></pre>
<p>To get the labelmap2D of another image in the stack which is not currently displayed:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> imageIdIndex = <span class="hljs-number">99</span>;

<span class="hljs-keyword">const</span> labelmap2DofImageIdIndex99 = getters.labelmap2DByImageIdIndex(
  labelmap3D,
  imageIdIndex,
  rows,
  columns
);
</code></pre>
<p>An example of this usage can be found in the <code>SphericalBrushTool</code>.</p>
<p>Both <code>getters.labelmap2D</code> and <code>getters.labelmap2DByImageIdIndex</code> will return the <code>Labelmap2D</code> if it exists, and create it and return it if not.</p>
<p>Additionally <code>getters.labelmap2D</code> will initialise and create both the <code>BrushStackState</code> and <code>Labelmap3D</code>, if neither exist yet.</p>
<h3 id="updating-labelmap-occupancy">Updating labelmap occupancy</h3>
<p>Upon finishing an operation on a <code>Labelmap2D</code>, the tool/operation should call <code>setters.updateSegmentsOnLabelmap2D(labelmap2D)</code> on the <code>Labelmap2D</code> to update its <code>segmentsOnLabelmap</code> property. This property being correct up to date is useful for other tools, and I/O libraries.</p>
<p>This is not done automatically, because the end of an operationn might depend on the task. E.g. after one use of the <code>CircleScissorsTool</code>, we&apos;ll call <code>updateSegmentsOnLabelmap2D</code>, however we only do it at the <em>end</em> of <code>BrushTool</code> stroke. You may have a more complicated procedure whereby you perform a series of iterative growcuts with human intervention, and only want to update the labelmap occupancy at the end.</p>
<h3 id="usage-by-application">Usage by application</h3>
<p>The parent application can retrieve information about the labelmaps by querying the API. From <code>metadata</code>, to <code>colorLUT</code>s per <code>Labelmap3D</code>.</p>
<p>The most useful getter function is probably <code>getLabelmaps3D(elementOrEnabledElementUID)</code>, which when given a cornerstone <code>element</code>, or a cornerstone <code>enabledElement</code>&apos;s UUID, returns a list of <code>Labelmap3D</code> objects, which can be parsed in order to generate UI.</p>
<p>A set of <code>setters</code> can be linked to UI components to change the active segment, set segment color, etc, refer to the API documentation for a full list of helpers.</p>
<h3 id="usage-by-third-party-libraries">Usage by third party libraries.</h3>
<p>You may wish to access one or more <code>Labelmap3D</code> <code>buffers</code> from outside <code>cornerstoneTools</code>, in order to either export them to persistent storage, or display them in another framwork, such as <a href="https://kitware.github.io/vtk-js/" target="_blank"><code>vtkjs</code></a>.</p>
<p>To retrieve the ArrayBuffer for the activeLabelmap on an <code>element</code>, from outside of <code>cornerstoneTools</code>:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { getters } = cornerstoneTools.getModule(<span class="hljs-string">&apos;segmentation&apos;</span>);

<span class="hljs-comment">// Active buffer:</span>
<span class="hljs-keyword">const</span> { buffer, labelmapIndex, colorLUT } = getters.activeLabelmapBuffer(
  element
);

<span class="hljs-comment">// All labelmap buffers:</span>
<span class="hljs-keyword">const</span> bufferInfoArray = getters.labelmapBuffers(element);

<span class="hljs-comment">// A specific buffer:</span>
<span class="hljs-keyword">const</span> { buffer7, colorLUT7 } = getters.labelmapBuffers(element, <span class="hljs-number">3</span>);
</code></pre>
<p>These functions also return the <code>colorLUT</code> (not just its index), so that you can map another renderer to the same color scheme. Note these are just helper functions, and you can indeed fetch all the <code>Labelmap3D</code> objects with <code>getters.labelmaps3D</code>, and extract this/more information if you desire.</p>
<h3 id="backdoor">Backdoor</h3>
<p>Note that other than from the API, you can always access the global <code>series</code> object:</p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { state } = getModule(<span class="hljs-string">&apos;segmentation&apos;</span>);
<span class="hljs-keyword">const</span> series = state.series;
</code></pre>
<p>But only modify these if you know what you are doing, as you could potentially break your application by uncleanly deleting/modifying things.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                

            </div>

            
                
                <a href="../custom-tools/#event-dispatcher-callbacks" class="navigation navigation-prev " aria-label="Previous page: Event Dispatcher Callbacks">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="./#global-configuration" class="navigation navigation-next " aria-label="Next page: GlobalConfiguration">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Modules","level":"3.5","depth":1,"next":{"title":"GlobalConfiguration","level":"3.5.1","depth":2,"anchor":"#global-configuration","path":"modules/index.md","ref":"modules/index.md#global-configuration","articles":[]},"previous":{"title":"Event Dispatcher Callbacks","level":"3.4.5","depth":2,"anchor":"#event-dispatcher-callbacks","path":"custom-tools/index.md","ref":"custom-tools/index.md#event-dispatcher-callbacks","articles":[]},"dir":"ltr"},"config":{"plugins":["edit-link","theme-cornerstone","-fontsettings","github","ga","sitemap","versions"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/cornerstonejs/cornerstoneTools"},"search":{},"theme-cornerstone":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"highlight":{},"sitemap":{"hostname":"https://tools.cornerstonejs.org"},"ga":{"configuration":"auto","token":"UA-110573590-1"},"versions":{"type":"branches","gitbookConfigURL":"https://raw.githubusercontent.com/cornerstonejs/cornerstoneTools/master/docs/book.json","options":[{"value":"https://tools.cornerstonejs.org/history/v2/","text":"Version 2.x"},{"value":"https://tools.cornerstonejs.org/history/v3/","text":"Version 3.x"},{"value":"https://tools.cornerstonejs.org/","text":"Version 4.x","selected":true}]},"sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/cornerstonejs/cornerstoneTools/edit/master/docs/latest"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"cornerstone-tools","links":{"sharing":{"facebook":false,"twitter":false}},"gitbook":">3.0.0"},"file":{"path":"modules/index.md","mtime":"2020-11-05T13:12:27.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-11-05T13:21:45.019Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-versions/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    </body>
</html>

